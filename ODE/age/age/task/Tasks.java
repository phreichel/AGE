//*************************************************************************************************
package age.task;
//*************************************************************************************************

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import age.input.Event;
import age.input.Events;
import age.input.InputType;

//*************************************************************************************************
public class Tasks {

	//=============================================================================================
	private final List<String> inbox  = new ArrayList<>();
	private final List<String> outbox = new ArrayList<>();
	private final Map<String, Task> tasks = new HashMap<>();
	//=============================================================================================

	//=============================================================================================
	public void assign(Events events) {
		events.assign(InputType.TASK_COMMAND, this::handleEvent);
	}
	//=============================================================================================

	//=============================================================================================
	private void handleEvent(Event e) {
		put(e.command());
	}
	//=============================================================================================
	
	//=============================================================================================
	public void put(String command) {
		synchronized (inbox) {			
			inbox.add(command);
		}
	}
	//=============================================================================================

	//=============================================================================================
	public void assign(String command, Task task) {
		tasks.put(command, task);
	}
	//=============================================================================================
	
	//=============================================================================================
	public void update() {
		synchronized (inbox) {
			outbox.addAll(inbox);
			inbox.clear();
		}
		for (String command : outbox) {
			perform(command);
		}
		outbox.clear();
	}
	//=============================================================================================

	//=============================================================================================
	private void perform(String command) {
		Task task = tasks.get(command);
		if (task != null) {
			task.perform();
		}
	}
	//=============================================================================================

}
//*************************************************************************************************
