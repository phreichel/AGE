/*
 * Commit: 921fe26242fec8aea55ed85b831bf841b11304e4
 * Date: 2023-09-30 17:42:43+02:00
 * Author: Philip Reichel
 * Comment: Added Material Parsing
Added Models
Remove Bigfile
Added Models
Revert "Added Models"

This reverts commit cd0e7c6f40612113283cf9300c40af491cd1bc2f.

 *
 */

//*************************************************************************************************
package age.util;
//*************************************************************************************************

import java.io.Reader;
import static age.util.TextUtil.*;

//*************************************************************************************************
public abstract class Scanner {

	//=============================================================================================
	private Reader reader = null;
	private char   look   = '\0';
	//=============================================================================================

	//=============================================================================================
	private int line;
	private int column;
	//=============================================================================================
	
	//=============================================================================================
	private Symbol symbol;
	private String token;
	//=============================================================================================
	
	//=============================================================================================
	public void init(Reader reader) {
		this.reader = reader;
		line = 1;
		column = 0;
		next();
		scan();
	}
	//=============================================================================================

	//=============================================================================================
	public void scan() {
		reset();
		if      (scanWhitespace());
		else if (scanLinebreak());
		else if (scanComment());
		else if (scanName());
		else if (scanNumber());
		else if (scanEndOfStream());
		else if (scanSymbol());
		else scanError();
	}
	//=============================================================================================

	//=============================================================================================
	public String token() {
		return this.token;
	}
	//=============================================================================================

	//=============================================================================================
	public Symbol symbol() {
		return this.symbol;
	}
	//=============================================================================================

	//=============================================================================================
	public int line() {
		return line;
	}
	//=============================================================================================

	//=============================================================================================
	public int column() {
		return column;
	}
	//=============================================================================================
	
	//=============================================================================================
	private char next() {
		try {
			int res = reader.read();
			look = (res == -1) ? '\0' : (char) res;
			if (!charMatch(look, '\0')) {
				if (charMatch(look, '\n')) {
					line++;
					column = 0;
				} else {
					column++;
				}
			}
			return look;
		} catch (Exception e) {
			throw new X(e);
		}
	}
	//=============================================================================================
	
	//=============================================================================================
	private boolean scanWhitespace() {
		if (isWhitespace(look)) {
			symbol = Symbol.WHITESPACE;
			while (isWhitespace(look)) {
				token += look;
				next();
			}
			return true;
		}
		return false;
	}
	//=============================================================================================

	//=============================================================================================
	private boolean scanLinebreak() {
		if (isLinebreak(look)) {
			symbol = Symbol.LINEBREAK;
			while (isLinebreak(look)) {
				token += look;
				next();
			}
			return true;
		}
		return false;
	}
	//=============================================================================================

	//=============================================================================================
	private boolean scanComment() {
		if (charMatch(look, '#')) {
			symbol = Symbol.COMMENT;
			token += look;
			next();
			while (!isLinebreak(look) | charMatch(look, '\0')) {
				token += look;
				next();
			}
			return true;
		}
		return false;
	}
	//=============================================================================================

	//=============================================================================================
	private boolean scanName() {
		if (isAlphaExt(look)) {
			symbol = Symbol.NAME;
			while (isAlphaExt(look) | isDecimal(look)) {
				token += look;
				next();
			}
			if (isKeyword(token)) {
				symbol = Symbol.KEYWORD;
			}
			return true;
		}
		return false;
	}
	//=============================================================================================

	//=============================================================================================
	private boolean scanNumber() {
		if (isDecimal(look)) {
			symbol = Symbol.NUMBER;
			while (isDecimal(look)) {
				token += look;
				next();
			}
			return true;
		}
		return false;
	}
	//=============================================================================================
	
	//=============================================================================================
	private boolean scanEndOfStream() {
		if (charMatch(look, '\0')) {
			symbol = Symbol.ENDOFSTREAM;
			token += look;
			return true;
		}
		return false;
	}
	//=============================================================================================

	//=============================================================================================
	// Matches anything that was not covered as 1 character symbol
	// and therefore should be placed last in any scan action.
	private boolean scanSymbol() {
		symbol = Symbol.SYMBOL;
		token += look;
		next();
		return true;
	}
	//=============================================================================================

	//=============================================================================================
	protected abstract boolean isKeyword(String s);
	//=============================================================================================

	//=============================================================================================
	private void reset() {
		symbol = Symbol.UNDEFINED;
		token = "";
	}
	//=============================================================================================
	
	//=============================================================================================
	private void scanError() {
		throw new X("Unexpected Scanner Error");
	}
	//=============================================================================================
	
}
//*************************************************************************************************
