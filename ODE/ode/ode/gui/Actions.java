//*************************************************************************************************
package ode.gui;
//*************************************************************************************************

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import ode.msg.MsgBox;
import ode.npa.Platform;

//*************************************************************************************************
public class Actions {

	//=============================================================================================
	public static final String CLOSE_PARENT = "close parent";
	public static final String TOGGLE_FULLSCREEN = "toggle fullscreen";
	public static final String QUIT = "quit";
	//=============================================================================================

	//=============================================================================================
	private Platform platform;
	private MsgBox msgbox;
	//=============================================================================================
	
	//=============================================================================================
	private final Map<String, Action> actions = new HashMap<>();
	private final List<Widget> widgets = new ArrayList<>();
	//=============================================================================================

	//=============================================================================================
	public Actions() {
		add(CLOSE_PARENT, this::closeParent);
		add(TOGGLE_FULLSCREEN, this::toggleFullscreen);
		add(QUIT, this::quit);
	}
	//=============================================================================================

	//=============================================================================================
	public void assign(Platform platform) {
		this.platform = platform;
	}
	//=============================================================================================
	
	//=============================================================================================
	public void assign(MsgBox msgbox) {
		this.msgbox = msgbox;
	}
	//=============================================================================================
	
	//=============================================================================================
	public void post(Widget widget) {
		widgets.add(widget);
	}
	//=============================================================================================

	//=============================================================================================
	public void add(String name, Action action) {
		actions.put(name, action);
	}
	//=============================================================================================
	
	//=============================================================================================
	public void update() {
		for (Widget widget : widgets) {
			Action action = actions.get(widget.action());
			action.perform(widget);
		}
		widgets.clear();
	}
	//=============================================================================================

	//=============================================================================================
	private void closeParent(Widget widget) {
		widget.parent().clear(Flag.DISPLAYED);
	}
	//=============================================================================================

	//=============================================================================================
	private void toggleFullscreen(Widget widget) {
		boolean toggle = !platform.fullscreen();
		platform.fullscreen(toggle);
	}
	//=============================================================================================
	
	//=============================================================================================
	private void quit(Widget widget) {
		msgbox
			.build()
			.terminate()
			.post();
	}
	//=============================================================================================
	
}
//*************************************************************************************************
